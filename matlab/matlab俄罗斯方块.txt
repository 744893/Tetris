大家好
本期视频是matlab版俄罗斯方块
matlab用起来比较顺手，而且确实方便很多
因此编写、调试只花了两天晚上
如图
俄罗斯方块的逻辑就不多作介绍了
主要讲一下matlab实现的细节和便利之处
这是总览，共157行代码
相比之下，贪吃蛇102行代码
先看函数情况
同样是主函数嵌套子函数的写法
ClearBlock，将指定位置开始指定大小的块清空
sr = start row,lr = length row
Refresh 重绘指定区域，参数同上
SetBlock,将指定位置开始的区域数据覆盖为block
先清除旧位置的色块
GetNewBlock，获取新方块，用于变形和一个方块移动结束后
产生新方块时，如果flag为1表示产生新方块，则在固定位置(顶部中间)
产生新方块，否则在当前位置产生新方块(先清除旧方块)，即为变形
Init，初始化游戏，先产生同样大小填充白色的矩形填满客户区
然后产生第一个方块
MaxDownDistance，判断方块最大下移距离，同LabVIEW版本
DownRows，将当前方块下移rows行
myKey，键盘响应函数，响应上下左右，上为变形，下为直接到底
myTimer，用于定时下降
下面介绍主函数及matlab实现俄罗斯方块的要点
首先是画布(客户区)的实现，需要一个figure、axes，
然后首先在axes上表格状铺满同样大小的rectangle
表示方块移动时，修改早已画好的矩形的填充颜色即可
而且rectangle自带边框，因此连网格线都画好了
当然说到这个，突然发现了matlab贪吃蛇的一个bug(不足)
就是每次移动蛇头、清除蛇尾时都是创建新的方块，吃到食物后
产生新的食物的时候也是创建方块，游戏时间长了满地图都是
叠加多层的方块，可能加重电脑负担
可以写成：未吃到食物时，将蛇尾移到蛇头新的位置；
吃到食物时将食物移到新的位置，旧的位置变成蛇头(改变颜色、加入数组，并不需要产生新的方块)，蛇尾方块也不需要任何改动
再说回俄罗斯方块
方块的表示，LabVIEW用的是一堆二维数组加颜色盒组成簇，再把不同种类方块的簇组合成最外层的簇，访问时用一个19个分支的条件结构实现
而matlab可以用一个19个元素的元胞数组(向量)
每个元胞放一个方块(二维数组)，每个数值为颜色索引，用于刷新显示时查找color_arr，可以看出，值为0时，将此处的矩形设为白色
这个元胞数组可以事先做好，保存为.mat(你们就不需要做了，如果想新增自定义方块，请便)
block_size和rc都以统一变量形式给出，方便更改
现在是20*10，大小为30的，可以运行
改为25*25，大小为20，也可以直接运行
但需要注意的是：显示得分的两个控件用的是绝对坐标，所以可能被覆盖
而且如果列数太多会导致游戏时间太长，看不清对齐的列，直接按下键容易失误
idTab为变形后新方块id的查找表，同LabVIEW
data和blocks为行列数同rc设置的数值数组和元胞数组
data用于记录颜色，blocks用于存放之前产生的rectangle对象
再用一个cur_block管理当前方块的属性，一个定时器ht用于定时触发下落
前4个函数就是”简单“的数组操作，当然，这是针对matlab说的
其它语言想实现同样的操作需要大量的代码
Refresh就是对刷新范围内的矩形根据data记录的颜色索引，修改其FaceColor(填充颜色)，另外，边框颜色是EdgeColor
Init函数产生所有的rectangle存入blocks
MaxDownDistance，最先进行的判断是，如果到达客户区底部，返回0，将不能继续下落
然后对每一列判断最大下落距离
比如图中最顶上的绿色方块和下面的红色方块的关系
第一次循环将满足all(data(boundary:boundary+1,ic))~=0
实际上每一次都满足，但不重要，也是返回0，不应继续下落
还有就是第三个条件分支，有三个判断表达式，还额外要求了j>boundary
如果不加这个的话，图中顶部的绿色方块，判断第一列时，当颜色由白色变为绿色时循环结束，无论下方是否有方块，都会返回0
RemoveRows，消除满行，累计得分
原理同LabVIEW版消除.vi，从底往上逐行遍历
记录满行，遇到空行停止循环，最后清除满行，在顶部添加等量的空行
但matlab实现会简单很多
remove记录消除的行数，reserve记录需要保留的行
matlab可以很容易的实现从数组里面提取多行多列
for i = rc(1):-1:1，倒序遍历
all(data(i,:)==0)，一整行所有列都为0，空行
any(data(i,:)==0)不为满行，加上上一个判断作为前提，
非满、非空，即需要保留的行
上一个条件取反即all(data(i,:)~=0)，一整行所有列都不为0，满行，将被消除
然后下面就是简单的数组操作了
添加新空行的操作为data(1:remove,:)=0，顶部remove行全设为0
DownRows有一个输入参数，是为了复用于定时下降单行和直接下降到底部两种情况
rows不为0，更新显示，rows为0时分为两种：当前方块移动完成，产生新的方块；或者游戏结束
游戏结束的判断机制：刚产生的新方块(cur_r为1或2，可能小于2更精确，不过差别不大)无法下降
游戏结束时显示提示，并停止定时器ht
按键还是只有5个，s开始游戏，上变形，下沉底，左右移动
值得注意的是左右加了限幅，不能将方块移出游戏区域
因为matlab数组越界访问将报错，因此加上
myTimer，没什么可说的
介绍完毕，演示一下
演示完毕，拜拜



























































































